/*! paging - v1.0.0 - 2016-05-08
* https://github.com/heroazure/paging#readme
* Copyright (c) 2016 ; Licensed  */
!function(a,b){!function(){"use strict";function b(a){return this instanceof b?(this.opt=a||{},this.canLoad=!0,void this.opt.$loadMore.on("click",b.prototype.handle)):new b(a)}function c(a){var b=this,c=b.canLoad;a=a||{};var d={page:a.page,url:a.url||"/",tpl:a.tpl||"",emptyTpl:a.emptyTpl||"",$loadMore:a.$loadMore||$("#load-more-record"),$targetContainer:a.$targetContainer||$("#container"),$listContainer:a.$listContainer,data:a.data||{},dataCallback:a.dataCallback,initCallback:a.initCallback,isLoop:a.isLoop||!1};if(d.$loadMore){if(d.page)d.data.page=d.page;else{var e=parseInt(d.$loadMore.data("currpage"))+1;d.isLoop&&b.maxpage<e&&(e=1),d.data.page=d.page=e}$.ajax({dataType:"Json",url:d.url,data:d.data,beforeSend:function(a){return c?(c=!1,"undefined"!=b.maxpage&&b.maxpage<d.page?(c=!0,!1):void d.$loadMore.text("正在加载中...")):!1},success:function(a){var c=a.data.data;if(!b.maxpage&&(b.maxpage=a.data.maxpage),1==parseInt(d.page)&&d.initCallback&&d.initCallback(b.maxpage,a),c&&Array.isArray(c)&&c.length){1==parseInt(d.page)&&(d.$listContainer?d.$listContainer.children().remove():d.$loadMore.prevAll().remove());var e=d.tpl;Mustache.parse(e),d.dataCallback&&d.dataCallback(c,b.maxpage,a);var f=Mustache.render(e,{items:c});d.$listContainer?d.$listContainer.append(f):(d.isLoop&&d.$loadMore.prevAll().remove(),d.$loadMore.before(f)),d.$loadMore.data("currpage",d.page),b.maxpage<=d.page?d.$loadMore.hide():d.$loadMore.text("加载更多...").show()}else 1==parseInt(d.page)?d.$targetContainer.html(d.emptyTpl):d.$loadMore.hide()},complete:function(){c=!0}})}}b.prototype.handle=function(){c.call(this,this.opt)},b.prototype.firstPage=function(){c.call(this,$.extend({},this.opt,{page:1}))},a.Page=b}(),"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=a.Page:"function"==typeof define&&define("common/paging-v1",["$"],function(require,exports,module){require("$");module.exports=a.Page})}(window);